<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project name="org.metaborg.meta.stratego.semantics" default="jar">

	<!-- overridden from Maven context -->
	<property name="strategojar" value="" />
	<property name="compileclasspath" value="" />
	<property name="nativeprefix" value="" />
	<property name="strategodistrib" value="" />
	<property name="sdf-str-sourcegen" value="" />

	<property name="syn-str" value="src/main" />
	<property name="syn" value="${syn-str}/sdf" />
	<property name="str" value="${syn-str}/stratego/spoofax/interpreter" />

	<!-- Importing Ant Macros -->
	<property name="nativepath" value="${nativeprefix}" />

	<taskdef classpath="${strategojar}" resource="org/strategoxt/antcontrib/strategoxt-antlib.xml" />
	<taskdef classpath="${strategojar}" resource="net/sf/antcontrib/antlib.xml" />


	<target name="jar" depends="" />

	<target name="generate-sources" depends="generate-from-sdf, generate-ctree">
		<echo message="${compileclasspath}" />
		<echo message="${strategojar}" />
		<echo message="${nativeprefix}" />
		<echo message="${strategodistrib}" />
		<echo message="${sdf-str-sourcegen}" />
	</target>

	<target name="generate-from-sdf">
		<local name="sdf-str-sourcegen-rel" />
		<property name="sdf-str-sourcegen-rel" value="${sdf-str-sourcegen}" relative="yes" />
		<mkdir dir="${sdf-str-sourcegen}" />
		<sdf2generated base="${syn}/Stratego-Shell" main="Stratego-Shell" output="${sdf-str-sourcegen-rel}">
			<includeargs>
				<args>
					<arg value="-I" />
					<arg value="${strategodistrib}/share/strategoxt/stratego-front/sdf" />
				</args>
			</includeargs>
		</sdf2generated>
	</target>

	<target name="generate-ctree">
		<strj input="${str}/frontend.str" output="${sdf-str-sourcegen}/frontend.ctree" package="">
			<strjargs>
				<arg value="-I" />
				<arg value="${syn-str}/stratego" />
				<arg value="-I" />
				<arg value="${sdf-str-sourcegen}" />
				<arg value="--library" />
				<arg value="-F" />
				<arg value="--clean" />
			</strjargs>
		</strj>
	</target>

</project>